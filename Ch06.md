# Ch06.函数定义和调用过程
* JavaScript是一种具有函数优先的轻量级，解释型或即时编译型的编程语言
（1）编译型语言（C）：写的程序执行之前，需要一个专门的编译过程，把所有的程序编译为机器语言的文件
（2）解释型语言（JS）：在运行程序的时候才编译，执行一段翻译一段代码
两种方式只是编译的时机不同
## 一、函数定义
[[scope]]确定
[[scope]]属性：函数创建时生成的属性。保存着这个函数的所有父级执行上下文环境中的变量对象的集合。是一个虚拟属性，无法访问和修改
## 二、函数调用
## 三、函数执行
### 1.JavaScript代码的执行过程
（1）js引擎是一段第一段运行代码的
（2）Js代码执行时会为当前代码创造相应的运行环境
### 2.JavaScript运行环境
（1）全局环境：文件一打开代码运行起来就会进入到一个全局环境
（2）函数环境：当函数被调用执行的时候，会进入当前函数中执行代码，此时会创建出一个函数环境
### 3.执行上下文创建阶段
#### 1）执行上下文
（1）可以理解为当前代码的运行环境
（2）作用是保存当前代码运行时所需要的数据
（3）在全局环境、函数环境中会创建执行上下文
#### 2）执行上下文栈（栈特点：后进先出）
（1）执行上下文栈按照函数的调用顺序来管理执行上下文
（2）栈底永远是全局上下文（当关闭浏览器或页面的时候才销毁全局上下文，浏览器开始，代码运行的时候全局上下文就存在），栈顶是当前正在执行的函数（函数执行的时候才会创建执行上下文）
（3）执行上下文栈的生命周期：当一个函数调用的时候，一个新的执行上下文就会被创建
①创建阶段（生成变量对象；确定作用域链；确定this指向）  
②执行阶段（边变量赋值；函数引用；执行其他代码）
③等待回收阶段（执行完毕后出栈，等待被回收）
#### 3）return语句
作用：返回值；终止函数的运行（销毁当前执行上下文，弹出执行上下文栈）
#### 4）生成变量对象：
##### （1）变量对象：
①是执行上下文相关的数据作用域
②是与上下文关联的特殊对象，用于存储被定义在上下文中
##### （2）变量对象的创建过程
①建立arguments对象
②检查当前上下文中的函数声明（function）创建属性
③检查当前上下文中的变量声明（var）创建属性
* 浏览器中的全局上下文的变量对象就是window对象，在页面关闭前一直存在。
##### （3）JavaScript的代码运行机制：
###### Ⅰ. 代码的执行分为两个阶段 
①代码编译阶段：将代码编译成可执行代码
②代码执行阶段：执行可执行代码
编译和执行是一个不断交替的过程
###### Ⅱ. js编译和执行的过程
①全局编译阶段（预解析）
②全局顺序执行阶段（变量赋值、函数调用等）
③当遇到函数调用的时候，在执行函数内代码前，进行函数范围内的编译
④当存在函数嵌套的时候，进行多次函数预解析
##### （4）声明提升：预解析的工作之一
所有的变量声明和函数声明提升到当前作用域的最前面
规则：①函数声明整体提前
②变量声明提前，赋值留在原地
③函数会首先被提升，然后才是变量
④函数声明有冲突，会覆盖；变量声明有冲突，会忽略（第二个）

#### 5）建立作用域链：由当前执行环境与所有父级执行环境的一系列变量对象组成（提供变量和函数访问的权限和顺    	序的规则）
#### （1）定义：作用域链是一套关于如何存储变量当中的值，并且能在这之后对这个值进行访问和修改的规则
#### （2）作用：指定变量与函数可访问范围；控制变量与函数的可见性
#### （3）作用域类型
###### Ⅰ. 全局作用域：
①在全局作用域下声明的变量叫做全局变量，全局变量在全局（代码的任何位置）下都可以使用，全局作用域中无法访问到局部作用域中的变量（访问变量，只能向上走不能向下走）
②全局变量的创建方式：
A）全局作用域下var声明的量
B）在函数内部没有使用var关键字声明直接赋值的变量（系统看成全局变量）
C）使用window全局对象创建的属性和方法。
###### Ⅱ. 函数作用域
①在函数作用域下声明的变量叫做局部变量，局部变量旨在当前函数内部使用；局部作用域中可以访问到全局	  作用域中的变量（反过来不行）
②局部作用域的创建方式
A）在函数内部通过var声明的变量
B）函数的形参
###### Ⅲ. 块作用域：任何一对花括号 { } 中的语句集都属于一个块，在这之中定义的所有变量在代码块外都是不可见的，我们称之为块级作用域
#### （4）作用域模型：
###### Ⅰ. 词法作用域（静态型）：由函数定义的书写位置确定的，与调用位置无关
        注意：通过new Function创建的函数对象不遵从词法作用域，此函数对象总是在全局作用域中执行（不敢		再哪个位置创建的，其父级总是全局作用域）
###### Ⅱ. 动态作用域（动态型）：由调用位置确定，不关心变量和函数的定义的书写位置
##### （5）变量函数访问规则：沿着作用域链从里向外查找，在找到第一个匹配的标识符时停止（只能找到一级标识符）
#### 6）确定this指向
### 4.执行上下文执行阶段
#### 1）变量赋值
2）执行其他代码
## 四、函数结束
执行上下文回收阶段
垃圾回收机制：当一个值失去引用之后（a=null）就会回收
1）被引用——不释放
2）不被引用——释放
